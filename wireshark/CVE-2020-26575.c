/*
Commit Number: v3.2.7-0-gfb6522d84a3a
URL: https://gitlab.com/wireshark/wireshark/-/issues/16887
Project Name: Wireshark
termination: FALSE
*/
#include <stdlib.h>
typedef signed char gint8;
typedef unsigned char guint8;
typedef unsigned short guint16;
typedef int  gint;
typedef unsigned int guint32;
typedef unsigned int  guint;
#define TAG_SNI  0x534E4900
#define TAG_VERS 0x56455253
#define TAG_SNO  0x534E4F00
#define TAG_AEAD 0x41454144
#define TAG_SCID 0x53434944
#define TAG_TIME 0x54494d45
#define TAG_ALPN 0x414C504E
#define TAG_PUBS 0x50554253
#define TAG_KEXS 0x4B455853
#define TAG_NONC 0x4E4F4E43
int __VERIFIER_nondet_unsigned_int();
_Bool __VERIFIER_nondet_bool();
struct tvbuff{
    unsigned char *real_data;
    unsigned int	length;
    unsigned int reported_length;
};
struct tvbuff;
typedef struct tvbuff tvbuff_t;

gint8
tvb_reported_length_remaining(const tvbuff_t *tvb, const gint offset)
{
    guint abs_offset = 0;

    if (tvb->reported_length >= abs_offset)
        return tvb->reported_length - abs_offset;
    else
        return 0;
}



static guint32
dissect_fb_zero_tag(tvbuff_t *tvb,  guint offset, guint32 tag_number){
    guint32 tag_offset_start = offset + tag_number*4*2;
    guint32 tag_offset = 0, total_tag_len = 0;
    gint tag_len;

    while(tag_number){
        int tag = __VERIFIER_nondet_unsigned_int();
        const guint8* tag_str;
        guint32 offset_end;
        offset += 4;

        tag_len = offset_end - tag_offset;
        total_tag_len += tag_len;
        offset += 4;
        tag_len = tvb_reported_length_remaining(tvb, tag_offset_start + tag_offset);
        offset_end = tag_offset + tag_len;
        switch(tag){
            case TAG_SNI:
                tag_offset += tag_len;
                break;
            case TAG_VERS:
                tag_offset += 4;
                break;
            case TAG_SNO:

                tag_offset += tag_len;
                break;
            case TAG_AEAD:
                while(offset_end - tag_offset >= 4){
                    tag_offset += 4;
                }
                break;
            case TAG_SCID:

                tag_offset += tag_len;
                break;
            case TAG_TIME:
                tag_offset += 4;
                break;
            case TAG_ALPN:
                tag_offset += 4;
                break;
            case TAG_PUBS:
                tag_offset += 2;
                while(offset_end - tag_offset >= 3){
                    tag_offset += 3;
                }
                break;
            case TAG_KEXS:
                while(offset_end - tag_offset >= 4){
                   tag_offset += 4;
                }
                break;
            case TAG_NONC:
                tag_offset += 32;
                break;

            default:
                tag_offset += tag_len;
                break;
        }

        if(tag_offset != offset_end){
            tag_offset = offset_end;
        }

        tag_number--;
    }
    return offset + total_tag_len;

}
//tvb->reported_length = 5, offset = 4,
int main(){
    tvbuff_t* tvb = (tvbuff_t*)malloc(sizeof (tvbuff_t));
    unsigned int offset = 4;
    tvb->reported_length = 5;
    while(tvb_reported_length_remaining(tvb, offset) > 0){
            guint32 message_tag, tag_number, length;
            offset += 1;
            offset += 4;
            if(__VERIFIER_nondet_bool()){

                offset += 4;

                tag_number = __VERIFIER_nondet_unsigned_int();
                offset += 2;
                offset += 2;

                offset = dissect_fb_zero_tag(tvb, offset, tag_number);
            } else {
                offset += length;
            }
        }

}